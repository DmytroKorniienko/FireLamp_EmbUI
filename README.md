# Управление

## По кнопке:
 * Из выключенного состояния
   - 1 касание - включить на последнем эффекте
   - 2 касания - включить в режиме ДЕМО
   - долгое удержание - включить в режиме "белая лампа" на максимальную яркость
   - касание, удержание - включить в режиме "белая лампа" на минимальную яркость (ночник)
 * Во включенном состоянии
   - 1 касание - выключить лампу
   - 2 касания - следующий эффект
   - 3 касания - предыдущий эффект
   - 4 касания - запуск сервиса ОТА
   - 5 касаний - вывод IP на лампу
   - 6 касаний - вывод текущего времени бегущей строкой
   - 7 касаний - смена рабочего режима лампы: с WiFi точки доступа на WiFi клиент или наоборот

   - удержание - регулировка яркости
   - 1 касание, удержание - регулировка "скорости" эффекта
   - 2 касания, удержание - регулировка "масштаба" эффекта

## По HTTP
команды можно посылать на лампу через браузер или curl по URL вида http://esp-xxxxxx/cmd?arg=param
  - /cmd?on  /cmd?off - вкл/выкл
  - /cmd?demo         - режим ДЕМО
  - /cmd?msg=Hello    - вывод сообщения на лампу
  - /cmd?bright=0-255 - яркость
  - /cmd?speed=0-255  - скорость
  - /cmd?scale=0-255  - шкала
  - /cmd?effect=N     - эффект номер N
  - /cmd?move_next    - следующий эффект
  - /cmd?move_prev    - предыдущий эффект
  - /cmd?move_rnd     - случайный эффект
  - /cmd?reboot       - перезагрузить лампу
  - /cmd?OTA          - запустить сервер обновления OTA



## Как собрать проект с помощью platformio

Для сборки проекта под platformio понадобится следующее:

Установить [IDE Visual Studio Code](https://code.visualstudio.com/), и в качестве плагина к ней установить [Platformio](https://platformio.org/). О том как это сделать можно найти массу роликов на youtube, например [этот](https://www.youtube.com/watch?v=NSljt17mg74).

 * Открываем папку проекта в VSCode
 * Что бы собрать прошивку, можно воспользоваться кнопками в нижней статусной строке:
   - PlatformIO:Build - собрать прошивку
   - PlatformIO:Upload - загрузить прошивку через USB в плату.

Platformio сам скачает необходимые бибиотеки для сборки проекта.

Также можно открыть терминал с помощью клавишь Ctrl+Shit+` и воспользоваться расширенными командами для сборки проекта.

 - **pio run** - собрать проект по умолчанию (esp8266dev), dev версия под esp8266 c выводом отладочных сообщений через serial интерфейс.
 - **pio run -e esp8266** - собрать версию esp8266, будет собрана облегченная прошивка без вывода отладочных сообщений через serial интерфейс
			    Рекомендуется для повседневного использования, если нет нужды отлаживать работу лампы
 - **pio run -e esp32dev** - собрать версию esp32dev, будет собрана прошивка под esp32 c выводом отладочных сообщений через serial интерфейс
 - **pio run -t upload** - собрать и прошить проект по умолчанию (esp8266dev)
 - **pio run -e esp8266 -t upload** - собрать и прошить облегченную версию 
 - **pio deviсe monitor** - запустить serial-монитор для просмотра сообщений, выдаваемых контроллером
 
 После первой прошивки дальнейшие обновления можно заливать в контроллер по воздуху. Для этого нужно зайти браузером на контроллер по URL вида http://jeeui-xxxx/update, где xxxx это ID контроллера, нажать на кномку 'Firmware', выбрать файл с прошивкой и загрузить его в контроллер.
 Файл с прошивкой Platformio кладет в подпапки проекта:
  - **.pio/build/esp8266/firmware.bin** - обычная версия под esp8266
  - **.pio/build/esp8266dev/firmware.bin** - debug версия под esp8266
  - **.pio/build/esp32dev/firmware.bin** - debug версия под esp32
